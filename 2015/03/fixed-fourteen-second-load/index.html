<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="canonical" href="http://www.rhysbower.com/2015/03/fixed-fourteen-second-load/"><meta property="og:locale" content="en_US"><meta property="og:site_name" content="Rhys Bower"><meta property="og:url" content="http://www.rhysbower.com/2015/03/fixed-fourteen-second-load/"><meta name="author" content="Rhys Bower"><link rel="author" href="https://plus.google.com/+RhysBowerDev/posts"><meta name="twitter:site" content="@BowerRhys"><meta name="twitter:creator" content="@BowerRhys"><title>How I fixed my over fourteen second, 31 HTTP request website. &ndash; Rhys Bower</title><meta name="description" content="When my portfolio initially went online it was hosted with Heroku on their free tier. This was great.  It was fast and easy to deploy with git but only after the server warmed up.
I noticed that some page loads were taking over fourteen seconds and 31 HTTP requests to download all of the content for that page. Fourteen seconds! This was unacceptable and I knew that it had to be fixed fast.
"><meta property="og:title" content="How I fixed my over fourteen second, 31 HTTP request website."><meta property="og:type" content="article"><meta property="og:image" content="http://www.rhysbower.com/img/posts/fixed-fourteen-second-load/fast-waterfall.png"><meta property="og:description" content="When my portfolio initially went online it was hosted with Heroku on their free tier. This was great.  It was fast and easy to deploy with git but only after the server warmed up.
I noticed that some page loads were taking over fourteen seconds and 31 HTTP requests to download all of the content for that page. Fourteen seconds! This was unacceptable and I knew that it had to be fixed fast.
"><meta property="article:published_time" content="2015-03-26 09:00:00 -0700"><meta property="article:modified_time" content="2015-03-26 09:00:00 -0700"><meta property="article:author" content="https://www.facebook.com/DevRhys"><meta property="article:tag" content="web"><meta property="article:tag" content="performance"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="How I fixed my over fourteen second, 31 HTTP request website."><meta name="twitter:description" content="When my portfolio initially went online it was hosted with Heroku on their free tier. This was great.  It was fast and easy to deploy with git but only after the server warmed up.
I noticed that some page loads were taking over fourteen seconds and 31 HTTP requests to download all of the content for that page. Fourteen seconds! This was unacceptable and I knew that it had to be fixed fast.
"><meta name="twitter:image" content="http://www.rhysbower.com/img/posts/fixed-fourteen-second-load/fast-waterfall.png"><link rel="apple-touch-icon-precomposed" sizes="152x152" href="http://www.rhysbower.com/favicon-152x152.png"><link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://www.rhysbower.com/favicon-144x144.png"><link rel="apple-touch-icon-precomposed" sizes="120x120" href="http://www.rhysbower.com/favicon-120x120.png"><link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://www.rhysbower.com/favicon-114x114.png"><link rel="apple-touch-icon-precomposed" sizes="76x76" href="http://www.rhysbower.com/favicon-76x76.png"><link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://www.rhysbower.com/favicon-72x72.png"><link rel="apple-touch-icon-precomposed" href="http://www.rhysbower.com/favicon-57x57.png"><link rel="shortcut icon" sizes="196x196" href="http://www.rhysbower.com/favicon-196x196.png"><link rel="shortcut icon" href="http://www.rhysbower.com/favicon.ico"><link rel="stylesheet" href="http://www.rhysbower.com/css/main.css"><!--[if lt IE 9]><script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script><![endif]--><link href="http://www.rhysbower.com/atom.xml" rel="alternate" title="Atom" type="application/atom+xml"><link href="http://www.rhysbower.com/sitemap.xml" rel="sitemap" title="Sitemap" type="application/xml"></head><body><nav class="main-nav"><div class="container"><div class="row"><div class="col-xs-4"><a href="http://www.rhysbower.com/"><img alt="Rhys Bower" class="head-shot img-responsive" src="http://www.rhysbower.com/img/profile.jpg"></a></div><div class="col-xs-8 nav-bar"><ul class="nav-list"><li class="nav-item"><a href="http://www.rhysbower.com/" class="nav-link">Home</a></li><li class="nav-item"><a href="http://www.rhysbower.com/portfolio/" class="nav-link">Portfolio</a></li></ul></div></div></div></nav><header><div class="container"><div class="row"><div class="col-xs-12 col-sm-8 col-sm-offset-4"><h1 class="article-title">How I fixed my over fourteen second, 31 HTTP request website.</h1></div></div></div></header><div class="container content"><div class="row"><div class="col-sm-9 col-sm-offset-1 col-md-8 col-md-offset-2"><div><i class="fa fa-calendar-o"></i> Mar 26, 2015</div><hr><article class="post"><p><strong>The problem with my slow site.</strong></p><p>When my portfolio initially went online it was hosted with <a href="http://www.heroku.com">Heroku</a> on their free tier. This was great. It was fast and easy to deploy with <code>git</code> but only after the server warmed up.</p><p>I noticed that some page loads were taking over fourteen seconds and 31 HTTP requests to download all of the content for that page. Fourteen seconds! This was unacceptable and I knew that it had to be fixed fast.</p><p><a href="http://www.rhysbower.com/img/posts/fixed-fourteen-second-load/slow-waterfall.png"><img class="img-responsive" src="http://www.rhysbower.com/img/posts/fixed-fourteen-second-load/slow-waterfall.png" alt="Fourteen second, 31 HTTP request waterfall"></a></p><p>To understand why this is we have to take a look at one of the key “features” of the Heroku free tier, server sleeping. Once a Heroku app with only one instance has been idle for an hour Heroku will sleep the server to save resources. Unfortunately my site is not that active and I hit the one hour with no hits fairly frequently, causing my server to sleep.</p><p><strong>Architecting a solution.</strong></p><p>My initial thought was to prevent Heroku from sleeping my server. The only way to do this is to add another server. The total for adding that server came to around $34.50 per month. It’s not a bad price for two load balanced web servers but I clearly didn’t need the extra capacity that they would provide.</p><p>At this time the site also was powered by a Ruby with Sinatra stack. In reality this was only to power the contact forum and nothing else.</p><p>I wanted to add a blog to this site as explained in <a href="http://www.rhysbower.com/2015/03/blogging-my-freelance-journey/">Blogging My Freelance Journey</a> so I switched my site from Ruby to PHP so that I could more easily integrate WordPress into a <code>/blog</code> sub-directory. Note that I chose to make the blog the home page of the domain in the end.</p><p>Now I needed a MySQL database to store the WordPress content and Heroku was only going to charge me more for the most basic functionality.</p><p>To get around the expensive hosting I made a list of the items that I wanted from my site:</p><ol><li>host some of my projects (or links to them as complex projects would most likely be on their own domain)</li><li>host a simple, static blog as the comments could be carried out over <a href="http://www.twitter.com/BowerRhys">Twitter</a>. <a href="https://disqus.com/">Disqus</a> is also a very popular commenting system for static websites and is an option to add comments to this site in the future.</li></ol><p>It was clear that all I needed was a static site. I knew that I needed a generator to include a standard header and footer on every page. <a href="http://jekyllrb.com/">Jekyll</a> is a simple, blog-aware, static site generator and is quite popular right now. It has the added bonus of automatic compilation on <a href="https://pages.github.com/">GitHub Pages</a>. Although I can no longer take advantage of this because of the tag plugin I use.</p><p><strong>GitHub Pages to the Rescue</strong></p><p>Because my site was already version controlled in <a href="http://git-scm.com/">Git</a> GitHub Pages was a logical service provider for my static site (plus it’s free).</p><p>After moving my site to Jekyll and GitHub Pages the speed increased greatly because of two reasons:</p><ol><li>GitHub has fast servers that don’t sleep (this is the majority of the speed up)</li><li>My site no longer needed to be compiled on every page load (this is a small factor)</li></ol><p>At this point I introduced <a href="http://gulpjs.com/">Gulp</a> to build the site. With Gulp I automated concatenation of the CSS and javascript (which I wasn’t doing before) and optimized images for the web. All together I was able to reduce the number of HTTP requests from 31 to 22 and the page size from 4.2 MB to 2.7 MB.</p><p>I should also mention that the size of the downloaded CSS was significantly reduced due to compiling Bootstrap from source and omitting the unused components but is a small factor compared to the image optimization.</p><p>With these changes I finally achieved sub two second response times. Still slow but much better than where I started.</p><p><a href="http://www.rhysbower.com/img/posts/fixed-fourteen-second-load/fast-waterfall.png"><img class="img-responsive" src="http://www.rhysbower.com/img/posts/fixed-fourteen-second-load/fast-waterfall.png" alt="Two second, 22 HTTP request waterfall"></a></p><p><strong>What’s next?</strong></p><p>There is still work to be done but I am more comfortable with the performance now than a week ago. Some things that I am considering are minifying the HTML and inlining the Google Analytics javascript to remove the need for the additional HTTP request as the only page that requires additional javascipt is the <a href="">portfolio</a> page.</p><p>I have heard good things about <a href="http://www.cloudflare.com/">CloudFlare</a> and will have to check them out. It will add another layer to the stack which I don’t really want to do especially because CDNs can be unpredictable as to when they update the cache of your content.</p><p><strong>Final Thoughts</strong></p><p>Heroku is a great platform and is very easy to use however it gets very expensive very quickly. Check it out only for production apps that need to run server side code.</p><p>I had to make some compromises with the new site specifically with the no comments nature of a static site and restricting my ability to run server side code. Hopefully the fourteen to two second load time and 31 to 22 HTTP request reductions will justify the compromises that were made.</p></article><hr><div><i class="fa fa-tags"></i> <a href="/tag/web" rel="tag">web</a>, <a href="/tag/performance" rel="tag">performance</a></div></div></div></div><footer><div class="footer-info"><div class="container"><div class="row"><div class="col-sm-4">Richmond BC, Canada <img alt="" class="map img-responsive" data-user="3077743" height="230" src="http://www.rhysbower.com/img/richmond.png" width="230"></div><div class="col-sm-4"><div class="row">Get in touch with me!</div><div class="row"><a href="https://github.com/RhysBower" target="_blank" class="link"><i class="fa fa-github-square social-icon"></i></a> <a href="https://twitter.com/BowerRhys" target="_blank" class="link"><i class="fa fa-twitter-square social-icon"></i></a> <a href="https://www.facebook.com/DevRhys" target="_blank" class="link"><i class="fa fa-facebook-square social-icon"></i></a> <a href="https://google.com/+RhysBowerDev" target="_blank" class="link"><i class="fa fa-google-plus-square social-icon"></i></a> <a href="http://www.rhysbower.com/atom.xml" target="_blank" class="link"><i class="fa fa-rss-square social-icon"></i></a></div><div class="row"><a href="mailto:bowerrhys@gmail.com?Subject=Website%20Enquiry" class="link"><i class="fa fa-envelope-o"></i> bowerrhys@gmail.com</a></div></div><div class="col-sm-4"><div class="row">About Rhys</div><p class="about-me">I'm an aspiring local developer working on a number of programming projects. I will be studying Computer Science at UBC next year.</p></div></div></div></div><div class="footer-copyright"><div class="container"><div class="row"><div class="col-md-12">Copyright © 2015 Rhys Bower.</div></div></div></div></footer><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-60475427-1', 'auto');
      ga('send', 'pageview');</script></body></html>